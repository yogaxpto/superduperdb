"use strict";(self.webpackChunknewdocs=self.webpackChunknewdocs||[]).push([[6507],{8686:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>a,frontMatter:()=>t,metadata:()=>o,toc:()=>l});var s=d(4848),r=d(8453);const t={},i=void 0,o={id:"api/misc/download",title:"download",description:"superduperdb.misc.download",source:"@site/content/api/misc/download.md",sourceDirName:"api/misc",slug:"/api/misc/download",permalink:"/docs/api/misc/download",draft:!1,unlisted:!1,editUrl:"https://github.com/SuperDuperDB/superduperdb/blob/main/docs/hr/content/api/misc/download.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"data",permalink:"/docs/api/misc/data"},next:{title:"hash",permalink:"/docs/api/misc/hash"}},c={},l=[{value:"<code>download_content</code>",id:"download_content",level:2},{value:"<code>download_from_one</code>",id:"download_from_one",level:2},{value:"<code>gather_uris</code>",id:"gather_uris",level:2},{value:"<code>timeout</code>",id:"timeout",level:2},{value:"<code>timeout_handler</code>",id:"timeout_handler",level:2},{value:"<code>BaseDownloader</code>",id:"basedownloader",level:2},{value:"<code>Downloader</code>",id:"downloader",level:2},{value:"<code>Fetcher</code>",id:"fetcher",level:2},{value:"<code>TimeoutException</code>",id:"timeoutexception",level:2},{value:"<code>Updater</code>",id:"updater",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"superduperdb.misc.download"})})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/SuperDuperDB/superduperdb/blob/main/superduperdb/misc/download.py",children:"Source code"})}),"\n",(0,s.jsx)(n.h2,{id:"download_content",children:(0,s.jsx)(n.code,{children:"download_content"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"download_content(db,\n     query: Union[superduperdb.backends.base.query.Query,\n     Dict],\n     ids: Optional[Sequence[str]] = None,\n     documents: Optional[List[superduperdb.base.document.Document]] = None,\n     raises: bool = True,\n     n_workers: Optional[int] = None) -> Optional[Sequence[superduperdb.base.document.Document]]\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"db"}),(0,s.jsx)(n.td,{children:"database instance"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"query"}),(0,s.jsx)(n.td,{children:"query to be executed"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ids"}),(0,s.jsx)(n.td,{children:"ids to be downloaded"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"documents"}),(0,s.jsx)(n.td,{children:"documents to be downloaded"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"raises"}),(0,s.jsx)(n.td,{children:"whether to raise errors"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"n_workers"}),(0,s.jsx)(n.td,{children:"number of download workers"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Download content contained in uploaded data."}),"\n",(0,s.jsxs)(n.p,{children:["Items to be downloaded are identifier\nvia the subdocuments in the form exemplified below. By default items are downloaded\nto the database, unless a ",(0,s.jsx)(n.code,{children:"download_update"})," function is provided."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'d = {"_content": {"uri": "<uri>", "encoder": "<encoder-identifier>"}}\ndef update(key, id, bytes):\n... with open(f\'/tmp/{key}+{id}\', \'wb\') as f:\n...     f.write(bytes)\ndownload_content(None, None, ids=["0"], documents=[d]))\n    \n'})}),"\n",(0,s.jsx)(n.h2,{id:"download_from_one",children:(0,s.jsx)(n.code,{children:"download_from_one"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"download_from_one(r: superduperdb.base.document.Document)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"r"}),(0,s.jsx)(n.td,{children:"document to download from"})]})})]}),"\n",(0,s.jsx)(n.p,{children:"Download content from a single document."}),"\n",(0,s.jsx)(n.p,{children:"This function will find all URIs in the document and download them."}),"\n",(0,s.jsx)(n.h2,{id:"gather_uris",children:(0,s.jsx)(n.code,{children:"gather_uris"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"gather_uris(documents: Sequence[superduperdb.base.document.Document],\n     gather_ids: bool = True) -> Tuple[List[str],\n     List[str],\n     List[Any],\n     List[str]]\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"documents"}),(0,s.jsx)(n.td,{children:"list of dictionaries"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"gather_ids"}),(0,s.jsxs)(n.td,{children:["if ",(0,s.jsx)(n.code,{children:"True"})," then gather ids of documents"]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Get the uris out of all documents as denoted by ",(0,s.jsx)(n.code,{children:'{"_content": ...}'}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"timeout",children:(0,s.jsx)(n.code,{children:"timeout"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"timeout(seconds)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"seconds"}),(0,s.jsx)(n.td,{children:"seconds until timeout"})]})})]}),"\n",(0,s.jsx)(n.p,{children:"Context manager to set a timeout."}),"\n",(0,s.jsx)(n.h2,{id:"timeout_handler",children:(0,s.jsx)(n.code,{children:"timeout_handler"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"timeout_handler(signum,\n     frame)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"signum"}),(0,s.jsx)(n.td,{children:"signal number"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"frame"}),(0,s.jsx)(n.td,{children:"frame"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Timeout handler to raise an TimeoutException."}),"\n",(0,s.jsx)(n.h2,{id:"basedownloader",children:(0,s.jsx)(n.code,{children:"BaseDownloader"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"BaseDownloader(self,\n     uris: List[str],\n     n_workers: int = 0,\n     timeout: Optional[int] = None,\n     headers: Optional[Dict] = None,\n     raises: bool = True)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"uris"}),(0,s.jsx)(n.td,{children:"list of uris/ file names to fetch"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"n_workers"}),(0,s.jsx)(n.td,{children:"number of multiprocessing workers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"timeout"}),(0,s.jsx)(n.td,{children:"set seconds until request times out"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"headers"}),(0,s.jsxs)(n.td,{children:["dictionary of request headers passed to",(0,s.jsx)(n.code,{children:"requests"})," package"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"raises"}),(0,s.jsxs)(n.td,{children:["raises error ",(0,s.jsx)(n.code,{children:"True"}),"/",(0,s.jsx)(n.code,{children:"False"})]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Base class for downloading files."}),"\n",(0,s.jsx)(n.h2,{id:"downloader",children:(0,s.jsx)(n.code,{children:"Downloader"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"Downloader(self,\n     uris,\n     update_one: Optional[Callable] = None,\n     ids: Union[List[str],\n     List[int],\n     NoneType] = None,\n     keys: Optional[List[str]] = None,\n     datatypes: Optional[List[str]] = None,\n     n_workers: int = 20,\n     headers: Optional[Dict] = None,\n     skip_existing: bool = True,\n     timeout: Optional[int] = None,\n     raises: bool = True)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"uris"}),(0,s.jsx)(n.td,{children:"list of uris/ file names to fetch"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"update_one"}),(0,s.jsx)(n.td,{children:"function to call to insert data into table"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ids"}),(0,s.jsx)(n.td,{children:"list of ids of rows/ documents to update"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"keys"}),(0,s.jsx)(n.td,{children:"list of keys in rows/ documents to insert to"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"datatypes"}),(0,s.jsx)(n.td,{children:"list of datatypes of rows/ documents to insert to"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"n_workers"}),(0,s.jsx)(n.td,{children:"number of multiprocessing workers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"headers"}),(0,s.jsxs)(n.td,{children:["dictionary of request headers passed to",(0,s.jsx)(n.code,{children:"requests"})," package"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"skip_existing"}),(0,s.jsxs)(n.td,{children:["if ",(0,s.jsx)(n.code,{children:"True"})," then don't bother getting already present data"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"timeout"}),(0,s.jsx)(n.td,{children:"set seconds until request times out"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"raises"}),(0,s.jsxs)(n.td,{children:["raises error ",(0,s.jsx)(n.code,{children:"True"}),"/",(0,s.jsx)(n.code,{children:"False"})]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Download files from a list of URIs."}),"\n",(0,s.jsx)(n.h2,{id:"fetcher",children:(0,s.jsx)(n.code,{children:"Fetcher"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"Fetcher(self,\n     headers: Optional[Dict] = None,\n     n_workers: int = 0)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"headers"}),(0,s.jsx)(n.td,{children:"headers to be used for download"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"n_workers"}),(0,s.jsx)(n.td,{children:"number of download workers"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Fetches data from a URI."}),"\n",(0,s.jsx)(n.h2,{id:"timeoutexception",children:(0,s.jsx)(n.code,{children:"TimeoutException"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"TimeoutException(self,\n     /,\n     *args,\n     **kwargs)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"args"}),(0,s.jsxs)(n.td,{children:["*args of ",(0,s.jsx)(n.code,{children:"Exception"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"kwargs"}),(0,s.jsxs)(n.td,{children:["**kwargs of ",(0,s.jsx)(n.code,{children:"Exception"})]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Timeout exception."}),"\n",(0,s.jsx)(n.h2,{id:"updater",children:(0,s.jsx)(n.code,{children:"Updater"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"Updater(self,\n     db,\n     query)\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"db"}),(0,s.jsx)(n.td,{children:"Datalayer instance"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"query"}),(0,s.jsx)(n.td,{children:"query to be executed"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Updater class to update the artifact."})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,d)=>{d.d(n,{R:()=>i,x:()=>o});var s=d(6540);const r={},t=s.createContext(r);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);